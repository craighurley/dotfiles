#!/usr/bin/env bash

###############################################################################
# boot2docker
###############################################################################

_boot2dockervm=boot2docker-vm
_cpucount=4
_cpucap=75
_memory=2048

_boot2docker=$(type -P boot2docker)
_vbox=$(type -P vboxmanage)

# check that vbox is installed
if [[ -f "$_vbox" ]] ; then
    # download boot2docker ISO image and configure cpu, cpu cap and memory allocations
    if [[ -f "$_boot2docker" ]] ; then
        $_boot2docker init
        rc=$?
        if [[ $rc == 0 ]] ; then
            if $_vbox showvminfo $_boot2dockervm --machinereadable | grep -q "poweroff" ; then
                $_vbox modifyvm $_boot2dockervm --cpus $_cpucount
                $_vbox modifyvm $_boot2dockervm --cpuexecutioncap $_cpucap
                $_vbox modifyvm $_boot2dockervm --memory $_memory
                $_vbox modifyvm $_boot2dockervm --groups "/docker"
            else
                echo "Error: $_boot2dockervm was powered on so no changes were applied."
            fi
        fi
    else
        echo "Error: boot2docker does not exist"
    fi
fi
