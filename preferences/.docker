#!/usr/bin/env bash

###############################################################################
# docker
###############################################################################

dockervm=docker-host
cpucount=4
cpucap=75
memory=2048

dm=$(type -P docker-machine)
v=$(type -P vboxmanage)

# check that vbox is installed
if [[ -f ${v} ]] ; then
    if [[ -f ${dm} ]] ; then
        $dm create -d virtualbox $dockervm
        rc1=$?
        $dm stop $dockervm
        rc2=$?
        if [[ $rc1 == 0 && $rc2 == 0 ]] ; then
            if $v showvminfo $dockervm --machinereadable | grep -q "poweroff" ; then
                $v modifyvm $dockervm --cpus $cpucount
                $v modifyvm $dockervm --cpuexecutioncap $cpucap
                $v modifyvm $dockervm --memory $memory
                $v modifyvm $dockervm --groups "/docker"
            else
                echo "Error: $dockervm is powered on so no changes were applied."
            fi
        fi
    else
        echo "Error: docker-machine does not exist"
    fi
fi
