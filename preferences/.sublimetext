#!/usr/bin/env bash

###############################################################################
# Sublime Text
###############################################################################

installedPackages=$HOME/Library/Application\ Support/Sublime\ Text\ 3/Installed\ Packages
packageControl=$installedPackages/Package\ Control.sublime-package

packagesUser=$HOME/Library/Application\ Support/Sublime\ Text\ 3/Packages/User
preferencesSource=$HOME/Projects/dotfiles/applications/sublimetext/Preferences.sublime-settings
preferencesTarget=$packagesUser/Preferences.sublime-settings
packageControlSource=$HOME/Projects/dotfiles/applications/sublimetext/Package\ Control.sublime-settings
packageControlTarget=$packagesUser/Package\ Control.sublime-settings

# make the required directories if they don't exist
[[ ! -d "$installedPackages" ]] && mkdir -p "$installedPackages"
[[ ! -d "$packagesUser" ]] && mkdir -p "$packagesUser"

# install package control
if [[ ! -f "$packageControl" ]] ; then
    echo "Downloading package control."
    if ! curl -# -f -o "$packageControl" https://packagecontrol.io/Package%20Control.sublime-package
    then
        echo "Something went wrong downloading package control."
        exit 1
    fi
fi

# link config files
if [[ -f "$preferencesSource" ]] ; then
    # Hack: temporarily removing 'color_scheme' from the preferences file until Sublime-Linter is auto installed
    # -- use git checkout to restore the line.
    sed -i.backup '/color_scheme/d' "$preferencesSource"
    ln -f -s "$preferencesSource" "$preferencesTarget"
fi

if [[ -f "$packageControlSource" ]] ; then
    ln -f -s "$packageControlSource" "$packageControlTarget"
fi
